syntax = "proto3";

package ipricing_model;

import "google/protobuf/struct.proto";

// --- Enums ---

enum ValueType {
  BOOLEAN = 0;
  NUMERIC = 1;
  TEXT = 2;
}

enum FeatureType {
  DOMAIN = 0;
  INFORMATION = 1;
  INTEGRATION = 2;
  AUTOMATION = 3;
  MANAGEMENT = 4;
  GUARANTEE = 5;
  SUPPORT = 6;
  PAYMENT = 7;
}

enum UsageLimitType {
  RENEWABLE = 0;
  NON_RENEWABLE = 1;
}

enum RenderMode {
  AUTO = 0;
  ENABLED = 1;
  DISABLED = 2;
}

enum TimeUnit {
  SEC = 0;
  MIN = 1;
  HOUR = 2;
  DAY = 3;
  MONTH = 4;
  YEAR = 5;
}

enum IntegrationType {
  API = 0;
  EXTENSION = 1;
  IDENTITY_PROVIDER = 2;
  WEB_SAAS = 3;
  MARKETPLACE = 4;
  EXTERNAL_DEVICE = 5;
}

enum AutomationType {
  BOT = 0;
  FILTERING = 1;
  TRACKING = 2;
  TASK_AUTOMATION = 3;
}

// --- Main Entities ---

message Feature {
  string name = 1;
  optional string description = 2;
  optional string tag = 3;
  ValueType value_type = 4;
  google.protobuf.Value default_value = 5;
  optional google.protobuf.Value value = 6;
  optional string expression = 7;
  optional string server_expression = 8;
  FeatureType type = 9;
  optional IntegrationType integration_type = 10;
  repeated string pricing_urls = 11;
  optional string doc_url = 12;
  optional AutomationType automation_type = 13;
  RenderMode render = 14;
}

message UsageLimit {
  string name = 1;
  optional string description = 2;
  optional bool trackable = 3;
  message Period {
    TimeUnit unit = 1;
    double value = 2;
  }
  optional Period period = 4;
  ValueType value_type = 5;
  google.protobuf.Value default_value = 6;
  optional google.protobuf.Value value = 7;
  string unit = 8;
  UsageLimitType type = 9;
  repeated string linked_features = 10;
  RenderMode render = 11;
}

message Plan {
  string name = 1;
  optional string description = 2;
  google.protobuf.Value price = 3; // Using string to support "number | string"
  string unit = 4;
  bool private = 5;
  map<string, Feature> features = 6;
  map<string, UsageLimit> usage_limits = 7;
}

message AddOn {
  string name = 1;
  optional string description = 2;
  google.protobuf.Value price = 3; // Using string to support "number | string"
  string unit = 4;
  bool private = 5;
  repeated string available_for = 6;
  repeated string depends_on = 7;
  repeated string excludes = 8;
  map<string, Feature> features = 9;
  map<string, UsageLimit> usage_limits = 10;
  map<string, UsageLimit> usage_limits_extensions = 11;
  message SubscriptionConstraints {
    double min_quantity = 1;
    double max_quantity = 2;
    double quantity_step = 3;
  }
  SubscriptionConstraints subscription_constraints = 12;
}

// --- Root of the Model ---

message Pricing {
  string saas_name = 1;
  string syntax_version = 2;
  string version = 3;
  optional string url = 4;
  string created_at = 5;
  string currency = 6;
  repeated string tags = 7;
  map<string, double> billing = 8;
  map<string, google.protobuf.Value> variables = 9;
  map<string, Feature> features = 10;
  map<string, UsageLimit> usage_limits = 11;
  map<string, Plan> plans = 12;
  map<string, AddOn> add_ons = 13;
  google.protobuf.Struct custom = 14; // To handle the 'any' type from TS
}