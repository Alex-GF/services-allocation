syntax = "proto3";

package ipricingModel;

import "google/protobuf/struct.proto";

// --- Enums ---

enum ValueType {
  NOT_SET_VALUE_TYPE = 0;
  BOOLEAN = 1;
  NUMERIC = 2;
  TEXT = 3;
}

enum FeatureType {
  NOT_SET_FEATURE_TYPE = 0;
  DOMAIN = 1;
  INFORMATION = 2;
  INTEGRATION = 3;
  AUTOMATION = 4;
  MANAGEMENT = 5;
  GUARANTEE = 6;
  SUPPORT = 7;
  PAYMENT = 8;
}

enum UsageLimitType {
  NOT_SET_USAGE_LIMIT_TYPE = 0;
  RENEWABLE = 1;
  NON_RENEWABLE = 2;
}

enum RenderMode {
  AUTO = 0;
  ENABLED = 1;
  DISABLED = 2;
}

enum TimeUnit {
  SEC = 0;
  MIN = 1;
  HOUR = 2;
  DAY = 3;
  MONTH = 4;
  YEAR = 5;
}

enum IntegrationType {
  NOT_SET_INTEGRATION_TYPE = 0;
  API = 1;
  EXTENSION = 2;
  IDENTITY_PROVIDER = 3;
  WEB_SAAS = 4;
  MARKETPLACE = 5;
  EXTERNAL_DEVICE = 6;
}

enum AutomationType {
  NOT_SET_AUTOMATION_TYPE = 0;
  BOT = 1;
  FILTERING = 2;
  TRACKING = 3;
  TASK_AUTOMATION = 4;
}

// --- Main Entities ---

message Feature {
  string name = 1;
  optional string description = 2;
  optional string tag = 3;
  optional ValueType valueType = 4;
  google.protobuf.Value defaultValue = 5;
  optional google.protobuf.Value value = 6;
  optional string expression = 7;
  optional string serverExpression = 8;
  optional FeatureType type = 9;
  optional IntegrationType integrationType = 10;
  repeated string pricingUrls = 11;
  optional string docUrl = 12;
  optional AutomationType automationType = 13;
  RenderMode render = 14;
}

message UsageLimit {
  string name = 1;
  optional string description = 2;
  optional bool trackable = 3;
  message Period {
    TimeUnit unit = 1;
    double value = 2;
  }
  optional Period period = 4;
  ValueType valueType = 5;
  google.protobuf.Value defaultValue = 6;
  optional google.protobuf.Value value = 7;
  string unit = 8;
  UsageLimitType type = 9;
  repeated string linkedFeatures = 10;
  RenderMode render = 11;
}

message Plan {
  string name = 1;
  optional string description = 2;
  google.protobuf.Value price = 3; // Using string to support "number | string"
  string unit = 4;
  bool private = 5;
  map<string, Feature> features = 6;
  map<string, UsageLimit> usageLimits = 7;
}

message AddOn {
  string name = 1;
  optional string description = 2;
  google.protobuf.Value price = 3; // Using string to support "number | string"
  string unit = 4;
  bool private = 5;
  repeated string availableFor = 6;
  repeated string dependsOn = 7;
  repeated string excludes = 8;
  map<string, Feature> features = 9;
  map<string, UsageLimit> usageLimits = 10;
  map<string, UsageLimit> usageLimitsExtensions = 11;
  message SubscriptionConstraints {
    double minQuantity = 1;
    double maxQuantity = 2;
    double quantityStep = 3;
  }
  SubscriptionConstraints subscriptionConstraints = 12;
}

// --- Root of the Model ---

message Pricing {
  string saasName = 1;
  string syntaxVersion = 2;
  string version = 3;
  optional string url = 4;
  string createdAt = 5;
  string currency = 6;
  repeated string tags = 7;
  map<string, double> billing = 8;
  map<string, google.protobuf.Value> variables = 9;
  map<string, Feature> features = 10;
  map<string, UsageLimit> usageLimits = 11;
  map<string, Plan> plans = 12;
  map<string, AddOn> addOns = 13;
  google.protobuf.Struct custom = 14; // To handle the 'any' type from TS
}