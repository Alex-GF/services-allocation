syntax = "proto3";

package ipricingModel;

import "google/protobuf/struct.proto";

// --- Enums ---

enum ValueType {
  BOOLEAN = 0;
  NUMERIC = 1;
  TEXT = 2;
}

enum FeatureType {
  DOMAIN = 0;
  INFORMATION = 1;
  INTEGRATION = 2;
  AUTOMATION = 3;
  MANAGEMENT = 4;
  GUARANTEE = 5;
  SUPPORT = 6;
  PAYMENT = 7;
}

enum UsageLimitType {
  RENEWABLE = 0;
  NON_RENEWABLE = 1;
}

enum RenderMode {
  AUTO = 0;
  ENABLED = 1;
  DISABLED = 2;
}

enum TimeUnit {
  SEC = 0;
  MIN = 1;
  HOUR = 2;
  DAY = 3;
  MONTH = 4;
  YEAR = 5;
}

enum IntegrationType {
  API = 0;
  EXTENSION = 1;
  IDENTITY_PROVIDER = 2;
  WEB_SAAS = 3;
  MARKETPLACE = 4;
  EXTERNAL_DEVICE = 5;
}

enum AutomationType {
  BOT = 0;
  FILTERING = 1;
  TRACKING = 2;
  TASK_AUTOMATION = 3;
}

// --- Main Entities ---

message Feature {
  string name = 1;
  optional string description = 2;
  optional string tag = 3;
  ValueType valueType = 4;
  google.protobuf.Value defaultValue = 5;
  optional google.protobuf.Value value = 6;
  optional string expression = 7;
  optional string serverExpression = 8;
  FeatureType type = 9;
  optional IntegrationType integrationType = 10;
  repeated string pricingUrls = 11;
  optional string docUrl = 12;
  optional AutomationType automationType = 13;
  RenderMode render = 14;
}

message UsageLimit {
  string name = 1;
  optional string description = 2;
  optional bool trackable = 3;
  message Period {
    TimeUnit unit = 1;
    double value = 2;
  }
  optional Period period = 4;
  ValueType valueType = 5;
  google.protobuf.Value defaultValue = 6;
  optional google.protobuf.Value value = 7;
  string unit = 8;
  UsageLimitType type = 9;
  repeated string linkedFeatures = 10;
  RenderMode render = 11;
}

message Plan {
  string name = 1;
  optional string description = 2;
  google.protobuf.Value price = 3; // Using string to support "number | string"
  string unit = 4;
  bool private = 5;
  map<string, Feature> features = 6;
  map<string, UsageLimit> usageLimits = 7;
}

message AddOn {
  string name = 1;
  optional string description = 2;
  google.protobuf.Value price = 3; // Using string to support "number | string"
  string unit = 4;
  bool private = 5;
  repeated string availableFor = 6;
  repeated string dependsOn = 7;
  repeated string excludes = 8;
  map<string, Feature> features = 9;
  map<string, UsageLimit> usageLimits = 10;
  map<string, UsageLimit> usageLimitsExtensions = 11;
  message SubscriptionConstraints {
    double minQuantity = 1;
    double maxQuantity = 2;
    double quantityStep = 3;
  }
  SubscriptionConstraints subscriptionConstraints = 12;
}

// --- Root of the Model ---

message Pricing {
  string saasName = 1;
  string syntaxVersion = 2;
  string version = 3;
  optional string url = 4;
  string createdAt = 5;
  string currency = 6;
  repeated string tags = 7;
  map<string, double> billing = 8;
  map<string, google.protobuf.Value> variables = 9;
  map<string, Feature> features = 10;
  map<string, UsageLimit> usageLimits = 11;
  map<string, Plan> plans = 12;
  map<string, AddOn> addOns = 13;
  google.protobuf.Struct custom = 14; // To handle the 'any' type from TS
}